<!DOCTYPE html>
<html>

<head>
    <title>Leb NH Historic Tour</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <style>
        body {
            padding: 0;
            margin: 0;
        }
        
        html,
        body,
        #mapid {
            height: 100%;
            width: 100%
        }
    </style>
</head>

<body>
    <div id="mapid"></div>
    <script>
        // initialize map in div id="mapid" element
        var mymap = L.map('mapid'),

            // set the center of our map, zoom level
            //mymap.setView([43.6410, -72.2693], 15);

            // url template for our map provider
            osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',

            // attribution that appears in right bottom corner of the map
            osmAttrib = 'Map Data and Text <a href="http://www.lebanonnhhistory.org/explore-lebanon/walking-tour-of-lebanon/">Lebanon Historical Society</a> | Base Map <a href="http://openstreetmap.org">OpenStreetMap</a> contributers',

            // create a tilelayer object for specific map data provider
            osm = new L.TileLayer(osmUrl, {
                minZoom: 12,
                maxZoom: 19,
                attribution: osmAttrib
            }).addTo(mymap),


            //placeholder variable name
            current_location, 
            current_accuracy; 

        
        //sets view
        mymap.locate({
            setView: true,
            maxZoom: 16
        });
        
        //if location is found, call onLocationFound() function
        mymap.on('locationfound', onLocationFound);
        //if there is an error, call onLocationError() function
        mymap.on('locationerror', onLocationError); 



        //loads geoJSON, then once that is done, calls function drawMap() to draw the map with the data
        $.getJSON('tour.geojson', function (data) {

            drawMap(data);

        });

        function drawMap(data) {

            var dataLayer = L.geoJson(data, {

                pointToLayer: function (feature, latlng) {
                    var marker = L.marker(latlng);

                    marker.bindPopup('<b>' + feature.properties.Name + '</b>' + '<br/>' + feature.properties.description);

                    return marker;
                }

            }).addTo(mymap);


            //sets zoom and map bounds to geoJSON layer
            /* mymap.fitBounds(dataLayer.getBounds(), {
                 padding: [100, 100]
             }); */
        }

        function onLocationFound(e) {

            var radius = e.accuracy / 2;

            current_location = L.marker(e.latlng).addTo(mymap)
                .bindPopup('woo!');

            //accuracy of location
            current_accuracy = L.circle(e.latlng, radius).addTo(mymap);

        }

        function onLocationError(e) {
            //if there's an error, have a popup come up saying the error
            alert(e.message);
        }
    </script>
</body>

</html>